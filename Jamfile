#
# Jamfile for Fitz
#
# mpage -s4 -f -2 -c -H -W110 include/*/*.h */*.c > listing.ps
# ps2pdf -sPAPERSIZE'='a4 listing.ps
#

include $(HOME)/.jamrules ;

HDRS = include filter ;

Library libfitz :
	# util stuff
	#util/cleanname.c
	#util/getopt.c
	#util/strsep.c
	#util/strlcpy.c
	#util/strlcat.c

	# base runtime
	base/cpudep.c
	base/error.c
	base/memory.c
	base/md5.c
	base/arc4.c
	base/rect.c
	base/matrix.c
	base/hash.c
	base/rune.c

	# object
	object/simple.c
	object/array.c
	object/dict.c
	object/print.c
	object/parse.c

	# filter
	filter/buffer.c
	filter/filter.c
	filter/filec.c		# unistd.h
	filter/filer.c		# unistd.h
	filter/filew.c		# unistd.h

	filter/null.c
	filter/arc4filter.c
	filter/pipeline.c

	filter/ahxd.c
	filter/ahxe.c
	filter/a85d.c
	filter/a85e.c
	filter/rld.c
	filter/rle.c
	filter/predict.c
	filter/lzwd.c
	filter/lzwe.c

	filter/faxd.c
	filter/faxdtab.c
	filter/faxe.c
	filter/faxetab.c

	filter/flate.c		# libz
	filter/dctd.c		# libjpeg
	filter/dcte.c		# libjpeg
	filter/jbig2d.c		# jbig2dec
	filter/jpxd.c		# jasper

	# tree
	tree/cmap.c
	tree/font.c
	tree/colorspace.c
	tree/image.c
	tree/shade.c

	tree/tree.c
	tree/node1.c
	tree/node2.c
	tree/text.c
	tree/path.c

	tree/debug.c
	tree/optimize.c

	# render
	render/glyphcache.c
	render/pixmap.c
	render/porterduff.c
	render/meshdraw.c
	render/imagedraw.c
	render/imageunpack.c
	render/imagescale.c
	render/pathscan.c
	render/pathfill.c
	render/pathstroke.c
	render/render.c

	render/archppc.c
	render/archsparc.c
	render/archx86.c
;

Library libmupdf :
	mupdf/debug.c
	mupdf/lex.c
	mupdf/parse.c
	mupdf/crypt.c

	mupdf/open.c
	mupdf/repair.c
	mupdf/save.c
	mupdf/xref.c
	mupdf/stream.c
	mupdf/doctor.c

	mupdf/nametree.c
	mupdf/outline.c
	mupdf/annot.c
	mupdf/pagetree.c

	mupdf/store.c
	mupdf/resources.c
	mupdf/function.c
	mupdf/colorspace1.c
	mupdf/colorspace2.c
	mupdf/xobject.c
	mupdf/image.c
	mupdf/pattern.c
	mupdf/shade.c
	mupdf/shade1.c
	mupdf/shade2.c
	mupdf/shade3.c
	mupdf/shade4.c
	mupdf/cmap.c
	mupdf/unicode.c
	mupdf/fontagl.c
	mupdf/fontenc.c
	mupdf/fontfile.c
#	mupdf/fontfilefc.c
#	mupdf/fontfilems.c
	mupdf/font.c
	mupdf/type3.c

	mupdf/page.c
	mupdf/build.c
	mupdf/interpret.c
	;

rule HexDump
{
	DEPENDS $(<) : $(>) ;
	Clean clean : $(<) ;
}

actions HexDump
{
	xxd -i $(>) | sed -e 's/data_//g;s/, /,/g' > $(<)
}

HexDump data/Dingbats.c : data/Dingbats.cff ;
HexDump data/NimbusMonL-Bold.c : data/NimbusMonL-Bold.cff ;
HexDump data/NimbusMonL-BoldObli.c : data/NimbusMonL-BoldObli.cff ;
HexDump data/NimbusMonL-Regu.c : data/NimbusMonL-Regu.cff ;
HexDump data/NimbusMonL-ReguObli.c : data/NimbusMonL-ReguObli.cff ;
HexDump data/NimbusRomNo9L-Medi.c : data/NimbusRomNo9L-Medi.cff ;
HexDump data/NimbusRomNo9L-MediItal.c : data/NimbusRomNo9L-MediItal.cff ;
HexDump data/NimbusRomNo9L-Regu.c : data/NimbusRomNo9L-Regu.cff ;
HexDump data/NimbusRomNo9L-ReguItal.c : data/NimbusRomNo9L-ReguItal.cff ;
HexDump data/NimbusSanL-Bold.c : data/NimbusSanL-Bold.cff ;
HexDump data/NimbusSanL-BoldItal.c : data/NimbusSanL-BoldItal.cff ;
HexDump data/NimbusSanL-Regu.c : data/NimbusSanL-Regu.cff ;
HexDump data/NimbusSanL-ReguItal.c : data/NimbusSanL-ReguItal.cff ;
HexDump data/StandardSymL.c : data/StandardSymL.cff ;
HexDump data/URWChanceryL-MediItal.c : data/URWChanceryL-MediItal.cff ;

Library libfonts :
	data/Dingbats.c
	data/NimbusMonL-Bold.c
	data/NimbusMonL-BoldObli.c
	data/NimbusMonL-Regu.c
	data/NimbusMonL-ReguObli.c
	data/NimbusRomNo9L-Medi.c
	data/NimbusRomNo9L-MediItal.c
	data/NimbusRomNo9L-Regu.c
	data/NimbusRomNo9L-ReguItal.c
	data/NimbusSanL-Bold.c
	data/NimbusSanL-BoldItal.c
	data/NimbusSanL-Regu.c
	data/NimbusSanL-ReguItal.c
	data/StandardSymL.c
	data/URWChanceryL-MediItal.c
	;

LINKLIBS =
	-lfreetype
	-ljbig2dec
	-ljasper
	-ljpeg
	-lz 
	-lm
	;

LINKLIBS on x11pdf$(SUFEXE) = -lX11 -lXext $(LINKLIBS) ;
LINKLIBS on w32pdf$(SUFEXE) = -lgdi32 $(LINKLIBS) ;

Main pdfclean : test/pdfclean.c ;
Main pdfdebug : test/pdfdebug.c ;
# Main pdfmerge : test/pdfmerge.c ;
Main pdfrip : test/pdfrip.c ;
# Main pdffunction : test/pdffunction.c ;

Main x11pdf : test/x11pdf.c test/ximage.c ;

CCFLAGS += `pkg-config --cflags gtk+ gthread` ;
LINKLIBS on gtkpdf = $(LINKLIBS) `pkg-config --libs gtk+ gmodule gthread` ;

LINKLIBS on carbonpdf = $(LINKLIBS) -framework Carbon ;

Main gtkpdf : test/gtkpdf.c ;

LinkLibraries
		pdfclean
		pdfdebug
		pdfmerge
		pdfrip
		pdffunction
		x11pdf
		gtkpdf
	: libmupdf libfonts libfitz ;

